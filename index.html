<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Regrid Survey</title>
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  body{font-family:Arial,Helvetica,sans-serif;background:#f0f4f4;min-height:100vh;display:flex;align-items:flex-start;justify-content:center;padding:48px 16px}
  .card{width:100%;max-width:640px;background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 12px 40px rgba(0,0,0,0.12);border:1px solid #ddd}
  .hdr{background:#008888;padding:52px 24px;text-align:center}
  .brand{color:#DAFF0A;font-size:52px;font-weight:900;letter-spacing:8px;text-transform:uppercase;line-height:1;margin-bottom:12px;display:block}
  .sub{color:#fff;font-size:22px;font-weight:700;margin-bottom:8px;display:block}
  .sup{color:rgba(218,255,10,0.9);font-size:15px;max-width:420px;margin:0 auto;line-height:1.5;display:block}
  .body{padding:40px}
  .field{margin-bottom:28px}
  label{display:block;font-size:14px;font-weight:700;margin-bottom:8px;color:#222}
  .req{color:#d93f4c;margin-left:2px}
  .hint{font-size:13px;color:#666;margin-top:5px;line-height:1.4}
  .stars{display:flex;gap:10px;justify-content:center;margin-bottom:8px}
  .star{font-size:48px;cursor:pointer;background:none;border:none;color:#ccc;outline:none;padding:0;line-height:1;transition:color 0.1s,transform 0.1s}
  .star.on{color:#DAFF0A}
  .star:hover{transform:scale(1.15)}
  .score-lbl{text-align:center;font-size:16px;color:#008888;font-weight:700;min-height:22px}
  .err{color:#d93f4c;font-size:13px;margin-top:6px;display:none}
  .err.show{display:block}
  select,textarea{width:100%;padding:13px;border:1px solid #ccc;border-radius:8px;font-size:15px;font-family:inherit;background:#fff;color:#333}
  textarea{min-height:110px;resize:vertical;line-height:1.6}
  .chk-row{display:flex;align-items:flex-start;gap:14px;margin-bottom:16px}
  .chk-row input{width:20px;height:20px;flex-shrink:0;accent-color:#008888;cursor:pointer;margin-top:2px}
  .chk-lbl{font-weight:600;font-size:14px;color:#222;cursor:pointer}
  .submit-btn{background:#DAFF0A;color:#1a1a00;border:none;border-radius:10px;padding:20px;font-size:18px;font-weight:800;cursor:pointer;width:100%;box-shadow:0 4px 10px rgba(218,255,10,0.3);margin-bottom:12px}
  .submit-btn:hover{background:#c8ec00}
  .submit-btn:disabled{opacity:0.6;cursor:not-allowed}
  .opt-btn{background:transparent;color:#888;border:1px solid #ddd;border-radius:10px;padding:14px;font-size:14px;cursor:pointer;width:100%}
  .screen{display:none}
  .screen.active{display:block}
  .success-icon{font-size:64px;text-align:center;margin-bottom:16px}
  .success-title{font-size:26px;font-weight:800;color:#008888;text-align:center;margin-bottom:12px}
  .success-msg{font-size:15px;color:#444;text-align:center;line-height:1.7}
  .optout-title{font-size:22px;font-weight:700;color:#555;text-align:center;margin-bottom:12px}
  .optout-msg{font-size:14px;color:#777;text-align:center;line-height:1.7}
  .submitting-msg{text-align:center;font-size:14px;color:#008888;margin-top:12px;display:none}
</style>
</head>
<body>
<div class="card">
  <div class="hdr">
    <span class="brand">REGRID</span>
    <span class="sub">Share Your Story</span>
    <span class="sup">Help us understand how Regrid data is changing your world</span>
  </div>

  <div id="screen-form" class="screen active">
    <div class="body">
      <div class="field" style="text-align:center">
        <label>Overall Rating <span class="req">*</span></label>
        <div class="stars" id="stars">
          <button class="star" type="button" data-v="1">&#9733;</button>
          <button class="star" type="button" data-v="2">&#9733;</button>
          <button class="star" type="button" data-v="3">&#9733;</button>
          <button class="star" type="button" data-v="4">&#9733;</button>
          <button class="star" type="button" data-v="5">&#9733;</button>
        </div>
        <div class="score-lbl" id="score-lbl">Select a rating</div>
        <div class="err" id="err-rating">A rating is required.</div>
      </div>

      <div class="field">
        <label for="industry">Industry <span class="req">*</span></label>
        <select id="industry">
          <option value="">Select your industry...</option>
          <option value="Academia">Academia</option>
          <option value="Agriculture">Agriculture</option>
          <option value="Automotive">Automotive</option>
          <option value="Construction">Construction</option>
          <option value="Consulting">Consulting</option>
          <option value="Education">Education</option>
          <option value="Energy">Energy</option>
          <option value="Environmental">Environmental</option>
          <option value="Finance">Finance</option>
          <option value="Government">Government</option>
          <option value="Healthcare">Healthcare</option>
          <option value="Insurance">Insurance</option>
          <option value="Legal">Legal</option>
          <option value="Logistics">Logistics</option>
          <option value="Manufacturing">Manufacturing</option>
          <option value="Media">Media</option>
          <option value="Non-Profit">Non-Profit</option>
          <option value="Real Estate">Real Estate</option>
          <option value="Retail">Retail</option>
          <option value="Technology">Technology</option>
          <option value="Telecommunications">Telecommunications</option>
          <option value="Transportation">Transportation</option>
          <option value="Travel">Travel</option>
          <option value="Utilities">Utilities</option>
          <option value="Other">Other</option>
        </select>
        <div class="err" id="err-industry">Please select your industry.</div>
      </div>

      <div class="field">
        <label for="story">How are you using Regrid data to win?</label>
        <p class="hint">Tell us your success story.</p>
        <textarea id="story" placeholder="Describe how Regrid data has helped you achieve your goals..."></textarea>
      </div>

      <div class="field">
        <label for="improve">What data or features are we missing?</label>
        <p class="hint">Help us improve.</p>
        <textarea id="improve" placeholder="What improvements would make Regrid even better for you?"></textarea>
      </div>

      <div class="field">
        <div class="chk-row">
          <input type="checkbox" id="c1" checked>
          <div>
            <label class="chk-lbl" for="c1">May we feature your success story?</label>
            <p class="hint">With your permission, we may share this in marketing materials.</p>
          </div>
        </div>
        <div class="chk-row">
          <input type="checkbox" id="c2">
          <div>
            <label class="chk-lbl" for="c2">May our team contact you about this feedback?</label>
          </div>
        </div>
      </div>

      <button class="submit-btn" id="submit-btn" type="button" onclick="submitSurvey()">Submit My Story</button>
      <div class="submitting-msg" id="submitting-msg">Saving your response...</div>
      <button class="opt-btn" type="button" onclick="optOut()">I'd rather not share feedback right now</button>
    </div>
  </div>

  <div id="screen-success" class="screen">
    <div class="body" style="padding:60px 40px;text-align:center">
      <div class="success-icon">&#10003;</div>
      <div class="success-title" id="success-title">Thank you!</div>
      <p class="success-msg">
        Your feedback has been received and will help us improve Regrid data for everyone.<br><br>
        We truly appreciate you taking the time to share your story.<br><br>
        <strong style="color:#008888">The Regrid Team</strong>
      </p>
    </div>
  </div>

  <div id="screen-optout" class="screen">
    <div class="body" style="padding:60px 40px;text-align:center">
      <div class="success-icon" style="font-size:48px">&#128075;</div>
      <div class="optout-title">No problem at all.</div>
      <p class="optout-msg">
        We respect your decision. If you ever want to share feedback in the future,<br>
        don't hesitate to reach out to our support team.
      </p>
    </div>
  </div>
</div>

<script>
// ─── CONFIGURATION ─────────────────────────────────────────────────────────
var ZENDESK_SUBDOMAIN = 'regrid';
var ZENDESK_EMAIL     = 'marquies@regrid.com';
var ZENDESK_API_TOKEN = 'vu51UqjvdWNjNo8a4YYbjMpH90dfBlnqnmIDprbo';
var CUSTOM_OBJECT_KEY = 'regrid_survey_response';
// ───────────────────────────────────────────────────────────────────────────

var rating = 0;
var labels = {1:'Poor',2:'Fair',3:'Good',4:'Very Good',5:'Excellent'};
var stars  = document.querySelectorAll('.star');

var params      = new URLSearchParams(window.location.search);
var nameParam   = params.get('name')     || '';
var ticketParam = params.get('ticketId') || params.get('ticket') || '';

if (nameParam) {
  document.getElementById('success-title').textContent = 'Thank you, ' + nameParam + '!';
}

stars.forEach(function(btn) {
  btn.addEventListener('mouseenter', function() { highlightStars(parseInt(btn.dataset.v)); });
  btn.addEventListener('mouseleave', function() { highlightStars(rating); });
  btn.addEventListener('click', function() {
    rating = parseInt(btn.dataset.v);
    highlightStars(rating);
    document.getElementById('score-lbl').textContent = rating + '/5 — ' + labels[rating];
    document.getElementById('err-rating').classList.remove('show');
  });
});

function highlightStars(n) {
  stars.forEach(function(s) {
    s.classList.toggle('on', parseInt(s.dataset.v) <= n);
  });
}

function submitSurvey() {
  var valid = true;
  if (!rating) {
    document.getElementById('err-rating').classList.add('show');
    valid = false;
  }
  if (!document.getElementById('industry').value) {
    document.getElementById('err-industry').classList.add('show');
    valid = false;
  }
  if (!valid) return;

  var submitBtn     = document.getElementById('submit-btn');
  var submittingMsg = document.getElementById('submitting-msg');
  submitBtn.disabled = true;
  submittingMsg.style.display = 'block';

  var payload = {
    custom_object_record: {
      name: 'Survey #' + (ticketParam || 'unknown') + ' — ' + (nameParam || 'Anonymous'),
      custom_object_fields: {
        ticket_id:       ticketParam,
        requester_name:  nameParam,
        requester_email: '',
        rating:          rating,
        industry:        document.getElementById('industry').value,
        success_story:   document.getElementById('story').value,
        improvements:    document.getElementById('improve').value,
        allow_marketing: document.getElementById('c1').checked,
        allow_contact:   document.getElementById('c2').checked,
        is_test:         false
      }
    }
  };

  var endpoint    = 'https://' + ZENDESK_SUBDOMAIN + '.zendesk.com/api/v2/custom_objects/' + CUSTOM_OBJECT_KEY + '/records';
  var credentials = btoa(ZENDESK_EMAIL + '/token:' + ZENDESK_API_TOKEN);

  fetch(endpoint, {
    method: 'POST',
    headers: {
      'Content-Type':  'application/json',
      'Authorization': 'Basic ' + credentials
    },
    body: JSON.stringify(payload)
  })
  .then(function(res) {
    if (!res.ok) { return res.text().then(function(t) { throw new Error(t); }); }
    return res.json();
  })
  .then(function() { showScreen('success'); })
  .catch(function(err) {
    console.error('Survey submission error:', err);
    showScreen('success');
  });
}

function optOut() { showScreen('optout'); }

function showScreen(name) {
  document.getElementById('screen-form').classList.remove('active');
  document.getElementById('screen-success').classList.remove('active');
  document.getElementById('screen-optout').classList.remove('active');
  document.getElementById('screen-' + name).classList.add('active');
}
</script>
</body>
</html>
